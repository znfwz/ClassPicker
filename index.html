<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ClassPicker - 课堂随机点名</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            colors: {
              gray: {
                750: '#2d3748',
                850: '#1a202c',
                950: '#0f172a',
              }
            },
            animation: {
              'spin-slow': 'spin 3s linear infinite',
            }
          }
        }
      }
    </script>

    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
      body {
        font-family: 'Inter', sans-serif;
      }
      /* Custom scrollbar */
      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }
      ::-webkit-scrollbar-track {
        background: transparent;
      }
      ::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 4px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #94a3b8;
      }
      /* Dark mode scrollbar */
      .dark ::-webkit-scrollbar-thumb {
        background: #4b5563;
      }
      .dark ::-webkit-scrollbar-thumb:hover {
        background: #6b7280;
      }
    </style>
<script type="importmap">
{
  "imports": {
    "react/": "https://aistudiocdn.com/react@^19.2.1/",
    "react": "https://aistudiocdn.com/react@^19.2.1",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.1/",
    "lucide-react": "https://aistudiocdn.com/lucide-react@^0.555.0"
  }
}
</script>
</head>
<body class="bg-gray-50 dark:bg-gray-900 transition-colors duration-200">
    <div id="root"></div>

    <script type="text/babel" data-presets="react,typescript">
      const { useState, useEffect, useCallback, useRef, useMemo } = React;

      // --- Icons (Replaces lucide-react for standalone usage) ---
      const IconBase = ({ children, className = "", ...props }) => (
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>
          {children}
        </svg>
      );

      const Loader2 = (props) => <IconBase {...props}><path d="M21 12a9 9 0 1 1-6.219-8.56" /></IconBase>;
      const Users = (props) => <IconBase {...props}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></IconBase>;
      const AlertCircle = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></IconBase>;
      const RotateCcw = (props) => <IconBase {...props}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></IconBase>;
      const Copy = (props) => <IconBase {...props}><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></IconBase>;
      const Play = (props) => <IconBase {...props}><polygon points="5 3 19 12 5 21 5 3"/></IconBase>;
      const CheckCircle2 = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></IconBase>;
      const User = (props) => <IconBase {...props}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></IconBase>;
      const Sparkles = (props) => <IconBase {...props}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></IconBase>;
      const GraduationCap = (props) => <IconBase {...props}><path d="M22 10v6M2 10l10-5 10 5-10 5z"/><path d="M6 12v5c3 3 9 3 12 0v-5"/></IconBase>;
      const Moon = (props) => <IconBase {...props}><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></IconBase>;
      const Sun = (props) => <IconBase {...props}><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></IconBase>;
      const Languages = (props) => <IconBase {...props}><path d="m5 8 6 6"/><path d="m4 14 6-6 2-3"/><path d="M2 5h12"/><path d="M7 2h1"/><path d="m22 22-5-10-5 10"/><path d="M14 18h6"/></IconBase>;

      // --- Constants ---
      const SAMPLE_STUDENTS_EN = `Alice Johnson\nBob Smith\nCharlie Davis\nDiana Evans\nEthan Harris\nFiona Clark\nGeorge Lewis\nHannah Walker`;
      const SAMPLE_STUDENTS_ZH = `李明\n王芳\n张伟\n刘洋\n陈杰\n杨娜\n赵强\n黄婷\n周杰\n吴小刚`;
      
      const ANIMATION_DURATION_MS = 1500;
      const SHUFFLE_INTERVAL_MS = 80;

      const TRANSLATIONS = {
        'en-US': {
          appTitle: 'ClassPicker',
          subtitle: 'MVP Random Call Tool',
          classList: 'Class List',
          sample: 'Sample',
          clearList: 'Clear List',
          placeholder: 'Enter student names here...\nOne name per line\nAlice\nBob\nCharlie',
          duplicatesDetected: 'Duplicates Detected:',
          duplicatesMessage: 'Duplicate names are treated as the same person.',
          confirmLoadSample: 'Replace current list with sample data?',
          confirmClear: 'Clear all names?',
          readyToStart: 'Ready to Start',
          readyDescription: 'Enter names on the left and click the button below to randomly select a student.',
          selecting: 'Selecting...',
          selectedStudent: 'Selected Student',
          rolling: 'Rolling...',
          allCalledReset: 'All Called - Reset?',
          randomPick: 'Random Pick',
          calledHistory: 'Called History',
          reset: 'Reset',
          noHistory: 'No students called yet',
          confirmResetHistory: 'Reset the history of called students?',
          confirmAllCalled: 'All students have been called! Start over?',
          looking: 'Looking...',
          sampleData: SAMPLE_STUDENTS_EN
        },
        'zh-CN': {
          appTitle: '课堂随机点名',
          subtitle: '简单高效的点名工具',
          classList: '学生名单',
          sample: '加载示例',
          clearList: '清空名单',
          placeholder: '在此输入学生姓名...\n每行一个名字\n张三\n李四\n王五',
          duplicatesDetected: '检测到重复姓名：',
          duplicatesMessage: '重复的姓名将被视为同一个人。',
          confirmLoadSample: '确定要用示例数据替换当前列表吗？',
          confirmClear: '确定要清空所有名字吗？',
          readyToStart: '准备就绪',
          readyDescription: '在左侧输入姓名，点击下方按钮开始随机点名。',
          selecting: '正在抽取...',
          selectedStudent: '幸运学生',
          rolling: '抽取中...',
          allCalledReset: '全部点完 - 重置？',
          randomPick: '随机点名',
          calledHistory: '已点名单',
          reset: '重置',
          noHistory: '暂无点名记录',
          confirmResetHistory: '确定要重置点名记录吗？',
          confirmAllCalled: '所有学生都已被点过！要重新开始吗？',
          looking: '寻找中...',
          sampleData: SAMPLE_STUDENTS_ZH
        }
      };

      // --- Components ---

      // Button Component
      const Button = ({ 
        children, 
        variant = 'primary', 
        size = 'md',
        isLoading, 
        icon,
        className = '',
        disabled,
        type = 'button',
        ...props 
      }) => {
        const baseStyles = "inline-flex items-center justify-center rounded-lg font-medium transition-all focus:outline-none focus:ring-2 focus:ring-offset-1 dark:focus:ring-offset-gray-900 disabled:opacity-50 disabled:cursor-not-allowed";
        
        const sizes = {
          sm: "px-3 py-1.5 text-sm",
          md: "px-4 py-2.5 text-base",
          lg: "px-6 py-3 text-lg"
        };

        const variants = {
          primary: "bg-indigo-600 text-white hover:bg-indigo-700 shadow-md shadow-indigo-200 dark:shadow-none focus:ring-indigo-500",
          secondary: "bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-200 border border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-600 focus:ring-gray-400",
          danger: "bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 hover:bg-red-100 dark:hover:bg-red-900/30 border border-red-200 dark:border-red-900/50 focus:ring-red-400",
          ghost: "text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 focus:ring-gray-400"
        };

        return (
          <button 
            type={type}
            className={`${baseStyles} ${sizes[size]} ${variants[variant]} ${className}`}
            disabled={disabled || isLoading}
            {...props}
          >
            {isLoading ? (
              <Loader2 className="w-4 h-4 mr-2 animate-spin" />
            ) : icon ? (
              <span className="mr-2 flex items-center">{icon}</span>
            ) : null}
            {children}
          </button>
        );
      };

      // InputPanel Component
      const InputPanel = ({ 
        rawInput, 
        setRawInput, 
        parsedCount,
        error,
        t
      }) => {
        const handleLoadSample = (e) => {
          e.preventDefault();
          setRawInput(t.sampleData);
        };

        const handleClear = (e) => {
          e.preventDefault();
          setRawInput('');
        };

        return (
          <div className="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 flex flex-col h-full overflow-hidden transition-colors duration-200">
            <div className="p-4 border-b border-gray-100 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50 flex items-center justify-between">
              <div className="flex items-center gap-2 text-gray-700 dark:text-gray-200 font-semibold">
                <Users className="w-5 h-5 text-indigo-600 dark:text-indigo-400" />
                <h2>{t.classList}</h2>
                <span className="bg-indigo-100 dark:bg-indigo-900/50 text-indigo-700 dark:text-indigo-300 text-xs px-2 py-0.5 rounded-full">
                  {parsedCount}
                </span>
              </div>
              <div className="flex gap-2">
                 <button 
                  type="button"
                  onClick={handleLoadSample}
                  className="text-xs text-indigo-600 dark:text-indigo-400 hover:text-indigo-800 dark:hover:text-indigo-300 hover:underline flex items-center gap-1"
                  title="Load sample data"
                >
                  <Copy className="w-3 h-3" /> {t.sample}
                </button>
              </div>
            </div>

            <div className="flex-1 p-4 relative flex flex-col bg-white dark:bg-gray-800">
              <textarea
                value={rawInput}
                onChange={(e) => setRawInput(e.target.value)}
                placeholder={t.placeholder}
                className="w-full flex-1 min-h-[200px] p-3 text-sm text-gray-800 dark:text-gray-100 bg-white dark:bg-gray-950 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent resize-none leading-relaxed placeholder-gray-400 dark:placeholder-gray-600 transition-colors"
                spellCheck={false}
              />
              
              {/* Validation Messages */}
              {error && error.type === 'duplicate' && (
                <div className="mt-3 p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-900/50 rounded-lg flex items-start gap-2">
                  <AlertCircle className="w-4 h-4 text-yellow-600 dark:text-yellow-500 mt-0.5 shrink-0" />
                  <div className="text-xs text-yellow-700 dark:text-yellow-400">
                    <span className="font-semibold block mb-0.5">{t.duplicatesDetected}</span>
                    <p>{error.items?.join(', ')}</p>
                    <p className="mt-1 opacity-75">{t.duplicatesMessage}</p>
                  </div>
                </div>
              )}
            </div>

            <div className="p-4 border-t border-gray-100 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50 flex justify-end">
              <Button 
                variant="ghost" 
                size="sm" 
                onClick={handleClear}
                disabled={!rawInput}
                className="text-xs h-8"
                icon={<RotateCcw className="w-3 h-3" />}
              >
                {t.clearList}
              </Button>
            </div>
          </div>
        );
      };

      // DisplayPanel Component
      const DisplayPanel = ({
        currentSelection,
        isAnimating,
        onPick,
        onResetHistory,
        remainingCount,
        totalCount,
        history,
        canPick,
        t
      }) => {
        
        const progress = totalCount > 0 ? ((totalCount - remainingCount) / totalCount) * 100 : 0;

        return (
          <div className="flex flex-col gap-6 h-full">
            {/* Main Result Card */}
            <div className="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-indigo-100 dark:border-gray-700 p-8 flex flex-col items-center justify-center text-center relative overflow-hidden min-h-[300px] transition-colors duration-200">
              
              {/* Background Decorations */}
              <div className="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500"></div>
              <div className="absolute -top-10 -right-10 w-32 h-32 bg-indigo-50 dark:bg-indigo-900/20 rounded-full blur-2xl opacity-50 pointer-events-none"></div>
              <div className="absolute -bottom-10 -left-10 w-40 h-40 bg-purple-50 dark:bg-purple-900/20 rounded-full blur-2xl opacity-50 pointer-events-none"></div>

              {/* Content */}
              <div className="relative z-10 flex flex-col items-center w-full">
                {currentSelection ? (
                  <>
                    <div className={`mb-6 p-4 rounded-full ${isAnimating ? 'bg-indigo-100 dark:bg-indigo-900/30 animate-pulse' : 'bg-green-100 dark:bg-green-900/30'}`}>
                      {isAnimating ? (
                        <Sparkles className="w-10 h-10 text-indigo-600 dark:text-indigo-400 animate-spin-slow" />
                      ) : (
                        <User className="w-10 h-10 text-green-600 dark:text-green-400" />
                      )}
                    </div>
                    
                    <h2 className="text-gray-500 dark:text-gray-400 text-sm font-medium tracking-wide uppercase mb-2">
                      {isAnimating ? t.selecting : t.selectedStudent}
                    </h2>
                    
                    <div className={`text-4xl md:text-5xl font-bold text-gray-900 dark:text-white transition-all duration-300 ${isAnimating ? 'opacity-50 blur-[1px] scale-95' : 'opacity-100 scale-100'}`}>
                      {currentSelection}
                    </div>
                  </>
                ) : (
                  <>
                    <div className="mb-6 p-4 rounded-full bg-gray-100 dark:bg-gray-700">
                      <User className="w-10 h-10 text-gray-400 dark:text-gray-500" />
                    </div>
                    <h3 className="text-xl font-medium text-gray-600 dark:text-gray-300 mb-2">{t.readyToStart}</h3>
                    <p className="text-gray-400 dark:text-gray-500 text-sm max-w-xs">
                      {t.readyDescription}
                    </p>
                  </>
                )}
              </div>

              {/* Action Button */}
              <div className="mt-10 w-full max-w-xs">
                <Button 
                  onClick={onPick} 
                  disabled={!canPick || isAnimating}
                  className="w-full h-12 text-lg shadow-indigo-200 dark:shadow-none"
                  icon={!isAnimating && <Play className="w-5 h-5 fill-current" />}
                >
                  {isAnimating ? t.rolling : remainingCount === 0 && totalCount > 0 ? t.allCalledReset : t.randomPick}
                </Button>
              </div>
            </div>

            {/* Progress & History Section */}
            <div className="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-5 flex-1 flex flex-col transition-colors duration-200">
              <div className="flex items-center justify-between mb-4">
                <h3 className="font-semibold text-gray-800 dark:text-gray-200 flex items-center gap-2">
                  <CheckCircle2 className="w-4 h-4 text-green-500" />
                  {t.calledHistory}
                </h3>
                <div className="flex items-center gap-3">
                  <span className="text-xs text-gray-500 dark:text-gray-400 font-medium">
                    {totalCount - remainingCount} / {totalCount}
                  </span>
                  <Button 
                    variant="secondary" 
                    size="sm" 
                    onClick={onResetHistory}
                    disabled={history.length === 0}
                    className="h-7 text-xs px-2"
                    title="Reset history"
                  >
                    <RotateCcw className="w-3 h-3 mr-1" /> {t.reset}
                  </Button>
                </div>
              </div>

              {/* Progress Bar */}
              <div className="w-full bg-gray-100 dark:bg-gray-700 rounded-full h-2 mb-4 overflow-hidden">
                <div 
                  className="bg-indigo-500 dark:bg-indigo-400 h-2 rounded-full transition-all duration-500 ease-out"
                  style={{ width: `${progress}%` }}
                ></div>
              </div>

              {/* List */}
              <div className="flex-1 overflow-y-auto min-h-[100px] border-t border-gray-100 dark:border-gray-700 pt-2">
                {history.length === 0 ? (
                  <div className="h-full flex items-center justify-center text-gray-400 dark:text-gray-500 text-sm italic">
                    {t.noHistory}
                  </div>
                ) : (
                  <ul className="space-y-2">
                    {[...history].reverse().map((student, idx) => (
                      <li key={`${student}-${idx}`} className="flex items-center justify-between p-2 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 group transition-colors">
                        <span className="text-gray-700 dark:text-gray-300 font-medium">{student}</span>
                        <span className="text-xs text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity">
                          #{history.length - idx}
                        </span>
                      </li>
                    ))}
                  </ul>
                )}
              </div>
            </div>
          </div>
        );
      };

      // App Component
      const App = () => {
        const [lang, setLang] = useState('zh-CN');
        const t = TRANSLATIONS[lang];

        const [rawInput, setRawInput] = useState('');
        const [students, setStudents] = useState([]);
        const [history, setHistory] = useState([]);
        const [currentSelection, setCurrentSelection] = useState(null);
        const [isAnimating, setIsAnimating] = useState(false);
        const [error, setError] = useState(null);
        const [isDarkMode, setIsDarkMode] = useState(false);

        const intervalRef = useRef(null);
        const timeoutRef = useRef(null);

        useEffect(() => {
          const root = window.document.documentElement;
          if (isDarkMode) {
            root.classList.add('dark');
          } else {
            root.classList.remove('dark');
          }
        }, [isDarkMode]);

        const toggleTheme = () => setIsDarkMode(!isDarkMode);
        const toggleLanguage = () => {
          setLang(prev => prev === 'en-US' ? 'zh-CN' : 'en-US');
        };

        useEffect(() => {
          const lines = rawInput
            .split('\n')
            .map(line => line.trim())
            .filter(line => line.length > 0);

          const uniqueLines = Array.from(new Set(lines));
          const hasDuplicates = uniqueLines.length !== lines.length;

          if (hasDuplicates) {
            const counts = {};
            const duplicates = [];
            lines.forEach(line => {
              counts[line] = (counts[line] || 0) + 1;
              if (counts[line] === 2) duplicates.push(line);
            });
            setError({ type: 'duplicate', message: t.duplicatesDetected, items: duplicates });
          } else {
            setError(null);
          }

          setStudents(uniqueLines);
          
          if (uniqueLines.length === 0) {
            setHistory([]);
            setCurrentSelection(null);
          }
        }, [rawInput, t]);

        const remainingStudents = useMemo(() => {
          return students.filter(s => !history.includes(s));
        }, [students, history]);

        const handlePick = useCallback(() => {
          if (students.length === 0 || isAnimating) return;
          
          let pool = remainingStudents;
          if (pool.length === 0) {
              if (window.confirm(t.confirmAllCalled)) {
                  setHistory([]);
                  pool = students;
              } else {
                  return;
              }
          }

          setIsAnimating(true);
          
          const animationPool = students.length > 1 ? students : [t.looking, t.selecting, students[0]];
          
          if (intervalRef.current) window.clearInterval(intervalRef.current);
          
          intervalRef.current = window.setInterval(() => {
            const randomPreview = animationPool[Math.floor(Math.random() * animationPool.length)];
            setCurrentSelection(randomPreview);
          }, SHUFFLE_INTERVAL_MS);

          if (timeoutRef.current) window.clearTimeout(timeoutRef.current);
          
          timeoutRef.current = window.setTimeout(() => {
            if (intervalRef.current) window.clearInterval(intervalRef.current);
            
            const winnerIndex = Math.floor(Math.random() * pool.length);
            const winner = pool[winnerIndex];
            
            setCurrentSelection(winner);
            setHistory(prev => [...prev, winner]);
            setIsAnimating(false);
          }, ANIMATION_DURATION_MS);

        }, [students, remainingStudents, t, isAnimating]);

        const handleResetHistory = (e) => {
          if (e) e.preventDefault();
          setHistory([]);
          setCurrentSelection(null);
        };

        useEffect(() => {
          return () => {
            if (intervalRef.current) window.clearInterval(intervalRef.current);
            if (timeoutRef.current) window.clearTimeout(timeoutRef.current);
          };
        }, []);

        return (
          <div className="min-h-screen bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 font-sans selection:bg-indigo-100 selection:text-indigo-900 dark:selection:bg-indigo-900 dark:selection:text-indigo-100 pb-12 transition-colors duration-200">
            
            {/* Navbar */}
            <nav className="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 sticky top-0 z-50 transition-colors duration-200">
              <div className="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
                <div className="flex items-center gap-2">
                  <div className="bg-indigo-600 p-1.5 rounded-lg">
                    <GraduationCap className="w-6 h-6 text-white" />
                  </div>
                  <h1 className="text-xl font-bold tracking-tight text-gray-900 dark:text-white">
                    {t.appTitle}
                  </h1>
                </div>
                <div className="flex items-center gap-2 sm:gap-4">
                  <div className="text-sm text-gray-500 dark:text-gray-400 hidden sm:block">
                    {t.subtitle}
                  </div>
                  
                  <div className="flex items-center gap-2">
                    <button
                      type="button"
                      onClick={toggleLanguage}
                      className="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors focus:outline-none focus:ring-2 focus:ring-indigo-500 flex items-center gap-1.5 text-sm font-medium"
                      aria-label="Toggle Language"
                    >
                      <Languages className="w-4 h-4" />
                      <span className="hidden sm:inline">{lang === 'en-US' ? '中文' : 'EN'}</span>
                    </button>

                    <button
                      type="button"
                      onClick={toggleTheme}
                      className="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors focus:outline-none focus:ring-2 focus:ring-indigo-500"
                      aria-label="Toggle Dark Mode"
                    >
                      {isDarkMode ? <Sun className="w-5 h-5" /> : <Moon className="w-5 h-5" />}
                    </button>
                  </div>
                </div>
              </div>
            </nav>

            <main className="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
              <div className="grid grid-cols-1 lg:grid-cols-12 gap-6 lg:h-[calc(100vh-140px)] min-h-[600px]">
                {/* Left Column: Input */}
                <div className="lg:col-span-4 h-full">
                  <InputPanel 
                    rawInput={rawInput} 
                    setRawInput={setRawInput}
                    parsedCount={students.length}
                    error={error}
                    t={t}
                  />
                </div>

                {/* Right Column: Display & History */}
                <div className="lg:col-span-8 h-full">
                  <DisplayPanel 
                    currentSelection={currentSelection}
                    isAnimating={isAnimating}
                    onPick={handlePick}
                    onResetHistory={handleResetHistory}
                    remainingCount={remainingStudents.length}
                    totalCount={students.length}
                    history={history}
                    canPick={students.length > 0}
                    t={t}
                  />
                </div>
              </div>
            </main>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
</body>
</html>